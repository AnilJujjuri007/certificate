def create_client():
    try:
        client = IoTHubModuleClient.create_from_connection_string(CONNECTION_STRING)
        client.connect()

        initial_twin_patch = None  # Global variable to store the first received twin patch

        def twin_patch_handler(twin_patch):
            nonlocal initial_twin_patch

            if initial_twin_patch is None:
                # Capture the initial twin data
                initial_twin_patch = twin_patch
                print("Initial Twin Data:")
                print(initial_twin_patch)

            print("Twin patch received:")
            print(twin_patch)

        client.on_twin_desired_properties_patch_received = twin_patch_handler

    except Exception as e:
        print("Error occurred:", e)
        return

    # Other setup code...

if __name__ == "__main__":
    create_client()
